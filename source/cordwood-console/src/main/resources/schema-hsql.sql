-- HSQLDB 数据库程序数据库初始化脚本

--
-- 创建用户表 ( users ) --

CREATE TABLE IF NOT EXISTS PUBLIC.USERS
(ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
MOBILE VARCHAR(45) NOT NULL,
NAME VARCHAR(45),
PASSWORD VARCHAR(100) NOT NULL,
UPDATETIME TIMESTAMP,
CREATETIME TIMESTAMP NOT NULL,
STATUS TINYINT NOT NULL,
ROLE TINYINT NOT NULL,
CLIENTTYPE TINYINT,
DEVICETOKEN VARCHAR(200),
PRIMARY KEY (ID),
UNIQUE (MOBILE));

--
-- 创建插件表 ( plugins ) --
CREATE TABLE IF NOT EXISTS PUBLIC.PLUGINS
(ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
PACKAGEID INTEGER NOT NULL,
NAME VARCHAR(45),
VERSION VARCHAR(100),
DESCRIPTION VARCHAR(800),
ISACTIVE BOOLEAN,
UPDATETIME TIMESTAMP,
CREATETIME TIMESTAMP,
PRIMARY KEY (ID),
UNIQUE (NAME));

--
-- 创建插件包表 ( plugin_packages ) --
CREATE TABLE IF NOT EXISTS PUBLIC.PLUGIN_PACKAGES
(ID INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
CHECKSUM VARCHAR(100) NOT NULL,
FILENAME VARCHAR(200) NOT NULL,
PRIMARY KEY (ID),
UNIQUE (CHECKSUM));

--
-- Spring session 持久化
--
CREATE TABLE IF NOT EXISTS PUBLIC.SPRING_SESSION (
    SESSION_ID CHAR(36),
    CREATION_TIME BIGINT NOT NULL,
    LAST_ACCESS_TIME BIGINT NOT NULL,
    MAX_INACTIVE_INTERVAL INT NOT NULL,
    PRINCIPAL_NAME VARCHAR(100),
    CONSTRAINT SPRING_SESSION_PK PRIMARY KEY (SESSION_ID)
);

CREATE INDEX IF NOT EXISTS SPRING_SESSION_IX1 ON SPRING_SESSION (LAST_ACCESS_TIME);

CREATE TABLE IF NOT EXISTS PUBLIC.SPRING_SESSION_ATTRIBUTES (
    SESSION_ID CHAR(36),
    ATTRIBUTE_NAME VARCHAR(200),
    ATTRIBUTE_BYTES LONGVARBINARY,
    CONSTRAINT SPRING_SESSION_ATTRIBUTES_PK PRIMARY KEY (SESSION_ID, ATTRIBUTE_NAME),
    CONSTRAINT SPRING_SESSION_ATTRIBUTES_FK FOREIGN KEY (SESSION_ID) REFERENCES SPRING_SESSION(SESSION_ID) ON DELETE CASCADE
);

CREATE INDEX IF NOT EXISTS SPRING_SESSION_ATTRIBUTES_IX1 ON SPRING_SESSION_ATTRIBUTES (SESSION_ID);

-- 数据库升级脚本