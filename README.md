Cordwood
========

cordwood 是一个基于 Spring
框架的web插件容器，可实现基于cordwood插件API的插件包热拔插。

 

目录结构
--------

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cordwood
    - demo 各类插件示例工程
    - doc 文档
    - LICENSE 许可证
    - README.md 本文档
    - source cordwood核心代码
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

工程结构
--------

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cordwood
    - cordwood-console 控制台程序（插件容器、插件管理）
    - cordwood-core 核心类库
    - cordwood-plugin-api 插件API（插件开发SDK）
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

词汇表
------

| 控制台 Home 目录 | cordwood-console 运行所产生的程序数据根目录                                   |
|------------------|-------------------------------------------------------------------------------|
| 插件 web 根路径  | 表示所有插件 web URL 的根路径，即 service 目录：http://localhost:8000/service |
|                  |                                                                               |

 

启动 cordwood 控制台
--------------------

当需要安装部署插件来验证功能时，需要启动控制台程序，然后将插件安装到控制台，再进行访问。

 

### 用 IDE 调试模式启动

build.gradle 默认提供了eclipse插件配置项，因此可以直接导入到 eclipse 及 eclipse
衍生类 IDE，因为使用了 spring-boot，所以建议使用 eclipse 的 spring boot
插件来启动，具体的，在安装了 spring 插件后，打开 “Boot Dashboard”，在列表中选中
cordwood-console，选择 debug，等待控制台启动成功。

 

以此方式启动控制台后，home 目录将位于：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.../cordwood-console/home-not-set/
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

### 用脚本方式运行

对于不需要调试控制台程序的场景，可以将控制台程序打包，然后通过脚本来运行，具体做法如下：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cd {source 目录}
./package.sh
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

执行完毕后，将在source目录下生成一个 dist 目录，结构如下：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
app.war  控制台可执行文件
README.md 发行包介绍信息（发行包中各个脚本使用方法，见此文件）
run.bat
run.sh
setenv.bat
setenv.sh
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

执行 ./run.sh start 来启动控制台程序。

 

以此方式启动控制台后，home 目录将位于：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
.../dist/data
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

控制台 Home 目录结构
--------------------

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cache   - 缓存
config  - 配置
data    - 数据
    attachment - 附件
    backups - 备份
    database - 数据库
    plugins - 插件安装目录
libs    - 插件所依赖的类库
logs    - 日志
temp    - 临时
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

开发插件
--------

在对整个 cordwood 根工程编译后

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
source/gradlew clean build -x test
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

将生成的插件包开发所需API类库文件复制到你自己的插件工程任意目录，然后加到构建路径中即可

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
cordwood-plugin-api/build/libs/cordwood-plugin-api-0.0.1.RELEASE.jar
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

### 示例插件

在 demo 目录中，提供了以下几个示例插件：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
pojo: 基于POJO(Plain Ordinary Java Object)的插件，即不使用任何框架、类库
spring-data: 基于 spring-data-jpa，连接 mysql 数据库的插件
velocity: 基于 velocity 模板引擎的web页面渲染插件
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

安装插件包
----------

将插件工程编译打包得到的 .jar
文件复制到控制台启动后所产生的插件目录中即可完成安装。

 

**注意：**请不要在控制台正在启动或停止的时候，安装、更新或卸载插件，因为插件包的变化会登记到数据库中，而控制台正在启动/停止的时候，数据库连接也许暂时无法使用。

 

卸载/更新插件包
---------------

在插件目录中删除或直接覆盖插件包，即可完成插件的卸载和更新。

 

部署插件依赖的类库
------------------

对于使用了第三方类库的插件包，需要将所依赖的 .jar 文件复制到：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
控制台home目录/libs
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

然后启动控制台，这些依赖的类库只在控制台启动期间会加载一次，所以在控制台运行期间，复制新的依赖包到此目录是无效的，需要通过重启控制台使其生效。

 

访问安装的插件功能
------------------

所有的插件被安装后，通过访问：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
http://host:port/service/{plugin name}/{plugin function}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

来调用插件功能。

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
@Pluggable(
    name = "demo",  // plugin name 即取的此属性值
    version = "1.0.0",
    description = "test only",
    readme = "http://www.google.com" )
public class ... {

    @Functional(
            name = "hello",  //plugin function 即取的此属性值
        resultType = "text/html" )
    public String ... () {}

}
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

 

如何使用示例插件
----------------

 

在demo目录中有如下示例工程，用于辅助插件开发者快速确定一些开发方式是否可行：

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
pojo: 简单JAVA对象，开发不依赖于第三方框架的插件

spring-boot: 基于 spring-boot 可自启动，也能安装到控制台，方便在不安装到控制台的情况下，用模拟容器来测试

spring-data: 基于 spring-data-jpa 实现数据库访问

velocity: 基于 velocity 模板引擎，实现 web 页面渲染
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
